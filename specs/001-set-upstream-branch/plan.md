# Implementation Plan: Set upstream branch on worktree checkout

**Branch**: `001-set-upstream-branch` | **Date**: 2026-02-26 | **Spec**: /home/chrisjust/Projects/worktree-manager/specs/001-set-upstream-branch/spec.md
**Input**: Feature specification from `/home/chrisjust/Projects/worktree-manager/specs/001-set-upstream-branch/spec.md`

**Note**: This plan was generated by `/speckit.plan`. Outputs are created under `/home/chrisjust/Projects/worktree-manager/specs/001-set-upstream-branch/`.

## Summary

Ensure the CLI configures the new branch's upstream when creating a worktree so that subsequent push/pull operations target the intended branch rather than the repository's default ref. Design decisions favor safety (no automatic push), determinism (prefer `origin` when ambiguous), and clear error messages for conflicts.

## Technical Context

**Language/Version**: Go 1.21
**Primary Dependencies**: none (standard library); the CLI will invoke the system `git` executable for worktree and branch operations
**Storage**: N/A
**Testing**: `go test ./...` for unit tests; integration tests will use ephemeral Git repositories and run on Linux/macOS runners
**Target Platform**: Linux, macOS, Windows (cross-platform CLI)
**Project Type**: CLI tool (worktree manager)
**Performance Goals**: Typical worktree creation completes under 3s in standard repos (informational)
**Constraints**: Must be safe by default, cross-platform, and avoid destructive operations without explicit confirmation
**Scale/Scope**: Low — single-user developer tooling; operates on local Git repositories

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

**Core Principles Compliance:**
- [x] CLI-First Design: Feature is defined as CLI behavior in the spec and contract
- [x] Git Integration Excellence: Uses Git worktree/branch semantics; plan relies on native Git operations
- [x] Safety and Predictability: Feature will not auto-push and will fail on name conflicts with clear remediation
- [x] Cross-Platform Compatibility: Plan uses Git CLI and Go; no platform-specific binaries required
- [x] Observability and Debugging: Plan includes clear CLI messages and quickstart verification steps
- [x] Simplicity and Minimalism: Narrow, focused feature addressing upstream configuration only

**Development Standards Compliance:**
- [x] Code Quality: Plan follows Go tooling (`go fmt`, `go vet`) and includes commands for CI
- [x] Testing Requirements: Unit and integration tests specified (ephemeral repos for integration tests)
- [x] Documentation Standards: Spec, plan, quickstart, and contracts are created for user and developer guidance

## Project Structure

### Documentation (this feature)

```text
/home/chrisjust/Projects/worktree-manager/specs/001-set-upstream-branch/
├── plan.md
├── research.md
├── data-model.md
├── quickstart.md
├── contracts/
│   └── wt-add.md
└── tasks.md (Phase 2 /speckit.tasks output)
```

### Source Code (selected structure)

```text
cmd/wt/                 # CLI entrypoint
internal/git/           # small wrappers around git exec calls and parsing
internal/worktree/      # worktree creation and validation logic
internal/cmd/           # command wiring and flags
tests/
├── unit/
└── integration/        # ephemeral git repos for testing upstream behavior
```

**Structure Decision**: Use a small Go CLI layout (`cmd/` + `internal/`) to keep the surface area minimal and maintain clear separation between git interaction and command wiring.

## Complexity Tracking

No constitution violations detected that require special justification. All core principles are adhered to by the design decisions documented below.

## Phase 0 — Research (outputs: research.md)

See `/home/chrisjust/Projects/worktree-manager/specs/001-set-upstream-branch/research.md` for decisions and rationale. Research tasks focus on safe upstream configuration, remote selection heuristics, and branch conflict behavior.

## Phase 1 — Design (outputs: data-model.md, contracts/, quickstart.md)

Design tasks include: deriving the lightweight data model for worktrees/branches, producing the `wt add` command contract (arguments, flags, exit codes), and a short quickstart demonstrating creation and verification.

## Agent Context Update

Will run: `/home/chrisjust/Projects/worktree-manager/.specify/scripts/bash/update-agent-context.sh opencode` to inject technology and plan notes into agent-specific context files.
